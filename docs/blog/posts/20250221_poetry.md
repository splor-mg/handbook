---
date: 2025-02-21
authors: [gabrielbdornas, hslinhares]
draft: false
comments: true
categories:
  - Webnar InteligÃªncia.MG
---

# Gerenciamento de DependÃªncias em Python com Poetry 2+

O [Poetry](https://python-poetry.org/docs/) Ã© uma ferramentas Python para, entre outros, realizar gerenciamento de dependÃªncias e publicaÃ§Ã£o de pacotes.
Para mim, ele se consolida a cada dia como uma alternativa robusta ao uso tradicional do `pip` e `virtualenv`, oferecendo uma soluÃ§Ã£o integrada e mais eficiente para nossos projetos.

<!-- more -->

ğŸš¨ Vamos tratar mais a fundo aqui apenas das funcionalidades de gerenciamento de dependÃªncias, podendo as opÃ§Ãµes referentes a publicaÃ§Ã£o de pacotes serem tratado em outro Post.

## O que Ã© o Poetry?

O Poetry Ã© uma ferramenta que simplifica a gestÃ£o de dependÃªncias e ambientes virtuais em projetos Python.
Ele resolve automaticamente versÃµes de pacotes, cria ambientes isolados e facilita a publicaÃ§Ã£o de bibliotecas no [PyPI](https://pypi.org/).
AlÃ©m disso, sua abordagem baseada no arquivo `pyproject.toml` proporciona um gerenciamento mais organizado e replicÃ¡vel de nossos projetos.

## DiferenÃ§as entre Poetry e Pip

### Pip

1. Usa arquivos `requirements.txt` para definir dependÃªncias. (1)
{ .annotate }

    1.  :man_raising_hand: Para instalar todas as dependÃªncias listadas em um arquivo `requirements.txt` vocÃª deve primeiro criar e ativar um ambiente virtual Python utilizando o mÃ³dulo `venv`:

        ```python
        # CriaÃ§Ã£o ambiente virtual Python Linux Ubuntu
        python3 -m venv venv

        # CriaÃ§Ã£o ambiente virtual Python Windows
        python -m venv venv

        # AtivaÃ§Ã£o ambiente virtual Python Linux Ubuntu
        source venv/bin/activate

        # AtivaÃ§Ã£o ambiente virtual Python Windows
        source venv/Scripts/activate

        # InstalaÃ§Ã£o pacotes Linux e Windows
        pip install -r requirements.txt
        ```

1. Requer o uso separado de `virtualenv` ou `venv` para criar ambientes isolados.
1. NÃ£o possui um gerenciador de versÃµes embutido.

### Poetry
- Utiliza `pyproject.toml` para definir dependÃªncias, tornando a configuraÃ§Ã£o mais estruturada.
- Gerencia ambientes virtuais automaticamente.
- Possui resoluÃ§Ã£o de dependÃªncias mais eficiente.
- Facilita a publicaÃ§Ã£o de pacotes Python sem necessidade de comandos extras.

## Como Utilizar o Poetry

### InstalaÃ§Ã£o

[A primeira maneira sugerida pela documentaÃ§Ã£o oficial](https://python-poetry.org/docs/#installing-with-pipx) Ã© utilizando o [pipx](https://pipx.pypa.io/stable/installation/):

```sh
pipx install poetry
```

### Criando um Novo Projeto

```sh
poetry new meu_projeto
cd meu_projeto
```

??? note "Isso cria um diretÃ³rio com a estrutura padrÃ£o de um pacote Python, incluindo `pyproject.toml`:"

    ```sh
    meu-projeto
    â”œâ”€â”€ pyproject.toml
    â”œâ”€â”€ README.md
    â”œâ”€â”€ meu_projeto
    â”‚   â””â”€â”€ __init__.py
    â””â”€â”€ tests
        â””â”€â”€ __init__.py
    ```

### Inicializando o Poetry em um Projeto Existente

Se vocÃª jÃ¡ tem um projeto (repositÃ³rio), e deseja incluir o Poetry criando o arquivo `pyproject.toml`, basta rodar:

```sh
poetry init # (1)!
```

1. :man_raising_hand: O assistente iterativo ajudarÃ¡ a configurar o novo arquivo `pyproject.toml` que serÃ¡ incluÃ­do no projeto.
Se quiser que o arquivo seja gerado sem essa iteraÃ§Ã£o basta incluir a flag `-n` no comando (`poetry init -n`).

### Instalando DependÃªncias (clone de um repositÃ³rio jÃ¡ existente)

Se vocÃª jÃ¡ tem um projeto (repositÃ³rio) que usa o Poetry (ou jÃ¡ contÃ©m o arquivo `pyproject.toml`) e deseja realizar o setup do mesmo em outro computador, basta rodar:

```sh
poetry install
```

O Poetry, entÃ£o, seguirÃ¡ a seguinte lÃ³gica:

1. **Se o arquivo `poetry.lock` existir** no repositÃ³rio, serÃ£o instaladas as dependÃªncias exatamente nas versÃµes especificadas nele, garantindo um ambiente reprodutÃ­vel.
1. **Se `poetry.lock` nÃ£o existir**, ele resolve as dependÃªncias a partir do `pyproject.toml`, gera o `poetry.lock` e entÃ£o instala os pacotes.

Agora, se o `pyproject.toml` foi modificado e vocÃª deseja ignorar essas alteraÃ§Ãµes e instalar **somente** o que estÃ¡ no `poetry.lock`, vocÃª pode usar:

```sh
poetry install --no-root
```

Isso evita a reinstalaÃ§Ã£o do prÃ³prio projeto no ambiente virtual e foca apenas nas dependÃªncias.

Se precisar de mais controle, hÃ¡ tambÃ©m o comando:

```sh
poetry lock --no-update
```

Ele garante que o `poetry.lock` nÃ£o seja modificado antes de uma instalaÃ§Ã£o.
Assim, quando vocÃª rodar `poetry install`, as dependÃªncias serÃ£o mantidas exatamente como estÃ£o no lockfile. ğŸ˜Š

### Adicionando DependÃªncias

Para adicionar um pacote ao projeto:

```sh
poetry add requests # (1)!
```

1. :man_raising_hand: O comando `poetry add`, alÃ©m de adicionar o pacote nos arquivos `pyproject.toml` e `poetry.lock` ele tambÃ©m o instala.
Se quiser que nÃ£o instale mas somente insira nos arquivos `pyproject.toml` e `poetry.lock` utilize a flag `--lock` (`poetry add requests --lock`).

Se for uma dependÃªncia de desenvolvimento:

```sh
poetry add pytest --group test
```

### Executando o Ambiente Virtual

O comando `poetry env activate` printa na tela o caminho para ativaÃ§Ã£o de seu ambiente virtual, **mas nÃ£o o ativa**.

=== "CÃ³digo"

    ```python
    poetry env activate
    ```
=== "Resultado"

    ```python
    source /home/gabrielbdornas/code/splor-mg/handbook/.venv/bin/activate # (1)!
    ```

    1. :man_raising_hand: Para [criar o ambiente virtual dentro do seu projeto](https://python-poetry.org/docs/main/configuration#virtualenvsin-project) Ã© necessÃ¡rio configurar a variÃ¡vel Poetry `virtualenvs.in-project` para `true`. Toda documentaÃ§Ã£o de configuraÃ§Ã£o Poetry pode ser encontrada [aqui](https://python-poetry.org/docs/main/configuration). Para acessar a lista das configuraÃ§Ãµes de sua instalÃ§Ã£o Poetry basta utilizar o comando `poetry config --list`.

[A documentaÃ§Ã£o sugere](https://python-poetry.org/docs/main/managing-environments#activating-the-environment) que vocÃ« pode usar o resultado deste comando para ativar o ambiente manualmente ou alimentar o comando `eval()` para esta ativaÃ§Ã£o(1).
{ .annotate }

1.  :man_raising_hand: [VersÃµes anteriores do Poetry](https://python-poetry.org/docs/managing-environments/#activating-the-environment) utilizavam o comando `poetry shell` para ativaÃ§Ã£o do ambiente virtual.


```sh
eval $(poetry env activate) # (1)!
```

  1. :man_raising_hand: O comando `eval $(poetry env activate)` interpreta e executa o comando de ativaÃ§Ã£o do ambiente virtual dentro do prÃ³prio terminal.
  Ele pega um comando passado como argumento, no nosso caso `poetry env activate`, e o executa.
  Ou seja, ele nÃ£o ativa o ambiente diretamente, mas retorna a string com o comando de ativaÃ§Ã£o correto para o terminal que vocÃª estÃ¡ usando (por exemplo, `source /caminho/do/venv/bin/activate`).
  O terminal entÃ£o executa a saÃ­da do comando `poetry env activate`, ativando o ambiente virtual sem iniciar um novo subprocesso.
  Isso evita que vocÃª tenha que copiar e colar manualmente o comando de ativaÃ§Ã£o.

## Outros comando interessantes

1. `poetry list`: mostra todos os comandos Poetry disponÃ­ves.
1. `poetry show`: mostra os pacotes instalados.


## TÃ³picos Adicionais Importantes para pesquisa

1. **Destaque para o suporte a mÃºltiplas versÃµes do Python**: O Poetry pode gerenciar diferentes versÃµes do Python de forma mais eficiente quando integrado ao [Pyenv](https://github.com/pyenv/pyenv).

1. **Melhoria na explicaÃ§Ã£o sobre `poetry.lock`**: Entender melhor seu funcionamento e como os processos de atualizaÃ§Ã£o podem impactar um projeto.

1. **SeÃ§Ã£o sobre `poetry export`**: O Poetry permite exportar dependÃªncias para um formato compatÃ­vel com `pip` com o comando `poetry export -f requirements.txt --output requirements.txt`.
Isso pode ser Ãºtil para ambientes onde o Poetry nÃ£o estÃ¡ instalado.

1. **Dicas sobre troubleshooting**: Algumas pessoas podem enfrentar problemas ao rodar `poetry install`, especialmente com dependÃªncias conflitantes.

1. **Poetry e GitHub Actions**: AutomatizaÃ§Ã£o de atualizaÃ§Ã£o dos pacotes utilizando [GitHub Actions](https://github.com/fuzzylabs/gha-poetry-update).

1. **PublicaÃ§Ã£o de pacotes**: Como dito no inÃ­cio, podemos utilizar o Poetry para publicaÃ§Ã£o de pacotes Python.
Entender bem este funcionamento, bem como a [exclusÃ£o desta funcionalidade](https://python-poetry.org/docs/main/pyproject#package-mode) caso necessÃ¡rio tambÃ©m Ã© interessante.

## ConclusÃ£o

Com o Poetry 2+, gerenciar dependÃªncias se tornou mais intuitivo e confiÃ¡vel, tornando essa ferramenta uma excelente escolha para projetos Python de qualquer tamanho.
A combinaÃ§Ã£o de um gerenciamento estruturado, resoluÃ§Ã£o eficiente de dependÃªncias e integraÃ§Ã£o com PyPI e Pyenv torna o Poetry indispensÃ¡vel para desenvolvedores que buscam produtividade e consistÃªncia em seus projetos.
Se vocÃª ainda nÃ£o experimentou o Poetry, vale a pena adotÃ¡-lo para melhorar seu fluxo de trabalho e garantir um ambiente mais organizado e previsÃ­vel.

## ReferÃªncias

- [DocumentaÃ§Ã£o Poetry](https://python-poetry.org/docs/).
- [Live de Python - Poetry](https://www.youtube.com/watch?v=ZOSWdktsKf0).

---
date: 2025-02-21
authors: [gabrielbdornas]
draft: false
comments: true
categories:
  - Webnar InteligÃªncia.MG
---

# Gerenciamento de DependÃªncias em Python com Poetry 2+

O [Poetry](https://python-poetry.org/docs/) Ã© uma ferramentas Python para, entre outros, realizar gerenciamento de dependÃªncias e publicaÃ§Ã£o de pacotes.
Para mim, ele se consolida a cada dia como uma alternativa robusta ao uso tradicional do `pip` e `virtualenv`, oferecendo uma soluÃ§Ã£o integrada e mais eficiente para nossos projetos.

<!-- more -->

ğŸš¨ Vamos tratar mais a fundo aqui apenas das funcionalidades de gerenciamento de dependÃªncias, podendo as opÃ§Ãµes referentes a publicaÃ§Ã£o de pacotes serem tratado em outro Post.

## O que Ã© o Poetry?

O Poetry Ã© uma ferramenta que simplifica a gestÃ£o de dependÃªncias e ambientes virtuais em projetos Python.
Ele resolve automaticamente versÃµes de pacotes, cria ambientes isolados e facilita a publicaÃ§Ã£o de bibliotecas no [PyPI](https://pypi.org/).
AlÃ©m disso, sua abordagem baseada no arquivo `pyproject.toml` proporciona um gerenciamento mais organizado e replicÃ¡vel de nossos projetos.

## DiferenÃ§as entre Poetry e Pip

### Pip

1. Usa arquivos `requirements.txt` para definir dependÃªncias. (1)
{ .annotate }

    1.  :man_raising_hand: Para instalar todas as dependÃªncias listadas em um arquivo `requirements.txt` vocÃª deve primeiro criar e ativar um ambiente virtual Python utilizando o mÃ³dulo `venv`:

        ```python
        # CriaÃ§Ã£o ambiente virtual Python Linux Ubuntu
        python3 -m venv venv

        # CriaÃ§Ã£o ambiente virtual Python Windows
        python -m venv venv

        # AtivaÃ§Ã£o ambiente virtual Python Linux Ubuntu
        source venv/bin/activate

        # AtivaÃ§Ã£o ambiente virtual Python Windows
        source venv/Scripts/activate

        # InstalaÃ§Ã£o pacotes Linux e Windows
        pip install -r requirements.txt
        ```

1. Requer o uso separado de `virtualenv` ou `venv` para criar ambientes isolados.
1. NÃ£o possui um gerenciador de versÃµes embutido.

### Poetry
- Utiliza `pyproject.toml` para definir dependÃªncias, tornando a configuraÃ§Ã£o mais estruturada.
- Gerencia ambientes virtuais automaticamente.
- Possui resoluÃ§Ã£o de dependÃªncias mais eficiente.
- Facilita a publicaÃ§Ã£o de pacotes Python sem necessidade de comandos extras.

## Como Utilizar o Poetry

### InstalaÃ§Ã£o

[A primeira maneira sugerida pela documentaÃ§Ã£o oficial](https://python-poetry.org/docs/#installing-with-pipx) Ã© utilizando o [pipx](https://pipx.pypa.io/stable/installation/):

```sh
pipx install poetry
```

### Criando um Novo Projeto

```sh
poetry new meu_projeto
cd meu_projeto
```

??? note "Isso cria um diretÃ³rio com a estrutura padrÃ£o de um pacote Python, incluindo `pyproject.toml`:"

    ```sh
    poetry-demo
    â”œâ”€â”€ pyproject.toml
    â”œâ”€â”€ README.md
    â”œâ”€â”€ poetry_demo
    â”‚   â””â”€â”€ __init__.py
    â””â”€â”€ tests
        â””â”€â”€ __init__.py
    ```

### Inicializando o Poetry em um Projeto Existente

Se vocÃª jÃ¡ tem um projeto, basta rodar:

```sh
poetry init # (1)!
```

1. O assistente interativo ajudarÃ¡ a configurar o novo arquivo `pyproject.toml` que serÃ¡ incluÃ­do no projeto.


### Adicionando DependÃªncias

Para adicionar um pacote ao projeto:

```sh
poetry add requests
```

Se for uma dependÃªncia de desenvolvimento:

```sh
poetry add pytest --group test
```

### Instalando DependÃªncias
```sh
poetry install
```

O Poetry, entÃ£o, seguirÃ¡ a seguinte lÃ³gica:

1. **Se o arquivo `poetry.lock` existir** no repositÃ³rio, serÃ£o instaladas as dependÃªncias exatamente nas versÃµes especificadas nele, garantindo um ambiente reprodutÃ­vel.
1. **Se `poetry.lock` nÃ£o existir**, ele resolve as dependÃªncias a partir do `pyproject.toml`, gera o `poetry.lock` e entÃ£o instala os pacotes.

Agora, se o `pyproject.toml` foi modificado e vocÃª deseja ignorar essas alteraÃ§Ãµes e instalar **somente** o que estÃ¡ no `poetry.lock`, vocÃª pode usar:

```sh
poetry install --no-root
```

Isso evita a reinstalaÃ§Ã£o do prÃ³prio projeto no ambiente virtual e foca apenas nas dependÃªncias.

Se precisar de mais controle, hÃ¡ tambÃ©m o comando:

```sh
poetry lock --no-update
```

Ele garante que o `poetry.lock` nÃ£o seja modificado antes de uma instalaÃ§Ã£o.
Assim, quando vocÃª rodar `poetry install`, as dependÃªncias serÃ£o mantidas exatamente como estÃ£o no lockfile. ğŸ˜Š

### Executando o Ambiente Virtual

```sh
eval $(poetry env activate) # (1)!
```

  1. :man_raising_hand: O comando `eval $(poetry env activate)` interpreta e executa o comando de ativaÃ§Ã£o do ambiente virtual dentro do prÃ³prio shell.
  Ele pega um comando passado como argumento, no nosso caso `poetry env activate`, e o executa dentro do shell atual.
  Ou seja, ele nÃ£o ativa o ambiente diretamente, mas retorna a string com o comando de ativaÃ§Ã£o correto para o shell que vocÃª estÃ¡ usando (por exemplo, `source /caminho/do/venv/bin/activate` para Bash).
  O shell executa a saÃ­da do comando `poetry env activate`, ativando o ambiente virtual sem iniciar um novo subprocesso. Isso evita que vocÃª tenha que copiar e colar manualmente o comando de ativaÃ§Ã£o.

Isso ativa o ambiente virtual gerenciado pelo Poetry (1).
{ .annotate }

1.  :man_raising_hand: [VersÃµes anteriores do Poetry](https://python-poetry.org/docs/managing-environments/#activating-the-environment) utilizavam o comando `poetry shell` para ativaÃ§Ã£o do ambiente virtual:



## Exemplos de Uso
### Criando um Script e Rodando com o Poetry
Se vocÃª tiver um script chamado `app.py`, pode rodÃ¡-lo dentro do ambiente virtual do Poetry sem precisar ativÃ¡-lo manualmente:
```sh
poetry run python app.py
```

## Fontes para Maior Pesquisa
- [DocumentaÃ§Ã£o Oficial do Poetry](https://python-poetry.org/docs/)
- [RepositÃ³rio no GitHub](https://github.com/python-poetry/poetry)

## TÃ³picos Adicionais Importantes
- **Lockfile (`poetry.lock`)**: garante que todas as dependÃªncias permaneÃ§am consistentes entre diferentes ambientes.
- **Uso com Docker**: Ã© possÃ­vel integrar o Poetry diretamente em imagens Docker.
- **Compatibilidade com Pyenv**: Poetry funciona bem com gestÃ£o de versÃµes do Python via Pyenv.

Com o Poetry 2+, gerenciar dependÃªncias se tornou mais intuitivo e confiÃ¡vel, tornando essa ferramenta uma excelente escolha para projetos Python de qualquer tamanho.
